<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta name="baidu-site-verification" content="UqlC4pwKIm" />
  <meta name="baidu-site-verification" content="d3U0dGeqGw" />
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.cat.net/css?family=Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Gradle插件," />





  <link rel="alternate" href="/atom.xml" title="渡口一艘船" type="application/atom+xml" />






<meta name="description" content="Gradle插件从入门到进阶 1、简介Gradle本身的领域对象主要有Project和Task。Project为Task提供了执行上下文，所有的Plugin要么向Project中添加用于配置的Property，要么向Project中添加不同的Task。一个Task表示一个逻辑上较为独立的执行过程，比如编译Java源代码，拷贝文件，打包Jar文件，甚至可以是执行一个系统命令或者调用Ant。另外，一">
<meta name="keywords" content="Gradle插件">
<meta property="og:type" content="article">
<meta property="og:title" content="Gradle插件从入门到进阶">
<meta property="og:url" content="https://xsfelvis.github.io/2019/05/02/Gradle插件从入门到进阶/index.html">
<meta property="og:site_name" content="渡口一艘船">
<meta property="og:description" content="Gradle插件从入门到进阶 1、简介Gradle本身的领域对象主要有Project和Task。Project为Task提供了执行上下文，所有的Plugin要么向Project中添加用于配置的Property，要么向Project中添加不同的Task。一个Task表示一个逻辑上较为独立的执行过程，比如编译Java源代码，拷贝文件，打包Jar文件，甚至可以是执行一个系统命令或者调用Ant。另外，一">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556208386784-dec2456e-561a-42f6-a679-a8c47f089872.png#align=left&display=inline&height=1221&name=image.png&originHeight=1221&originWidth=587&size=231915&status=done&width=587">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556039101293-ed67fa06-d53e-436e-9e98-3b5a8d78d851.png#align=left&display=inline&height=326&name=image.png&originHeight=382&originWidth=875&size=106084&status=done&width=746">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556039163910-6ee5a942-7599-4a9c-a78a-ccf14e3d4783.png#align=left&display=inline&height=450&name=image.png&originHeight=450&originWidth=702&size=90267&status=done&width=702">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556193021427-9d3cda16-11cd-4908-8f9c-aac56947ad6e.png#align=left&display=inline&height=806&name=image.png&originHeight=1081&originWidth=1000&size=214151&status=done&width=746">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556205376270-23df6fcc-2d91-45ba-af71-ce6a810df505.png#align=left&display=inline&height=371&name=image.png&originHeight=497&originWidth=1000&size=140744&status=done&width=746">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556265446764-f824db8c-0d7f-4a36-b9ac-5c2dac1725d5.png#align=left&display=inline&height=242&name=image.png&originHeight=483&originWidth=1000&size=213329&status=done&width=500">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556187110722-537b15e2-6470-443b-b4d1-ac1e6bd1cbaf.png#align=left&display=inline&height=275&name=image.png&originHeight=275&originWidth=727&size=81528&status=done&width=727">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556371938551-daac116f-1a1c-4d09-bf3f-417540040dd9.png#align=left&display=inline&height=391&name=image.png&originHeight=599&originWidth=388&size=182758&status=done&width=253">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556078731941-534fb4b2-30f5-4b99-92c9-5ae4fc9a5e58.png#align=left&display=inline&height=205&name=image.png&originHeight=205&originWidth=730&size=56119&status=done&width=730">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556294955734-077629bb-f1c0-4edf-a849-6bad29cb7e73.png#align=left&display=inline&height=322&name=image.png&originHeight=643&originWidth=1000&size=373331&status=done&width=500">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556806007519-8dca98a3-a43f-4ffa-b4ba-451bf4ce8f30.png#align=left&display=inline&height=275&name=image.png&originHeight=549&originWidth=1000&size=339915&status=done&width=500">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556122864808-85593771-2038-40a0-a121-faca52cabe6b.png#align=left&display=inline&height=769&name=image.png&originHeight=1442&originWidth=1398&size=163578&status=done&width=746">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556123502143-259a6f70-5190-4072-9cd2-dc93476d3a29.png#align=left&display=inline&height=611&name=image.png&originHeight=611&originWidth=439&size=95538&status=done&width=439">
<meta property="og:updated_time" content="2019-05-02T15:14:17.388Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Gradle插件从入门到进阶">
<meta name="twitter:description" content="Gradle插件从入门到进阶 1、简介Gradle本身的领域对象主要有Project和Task。Project为Task提供了执行上下文，所有的Plugin要么向Project中添加用于配置的Property，要么向Project中添加不同的Task。一个Task表示一个逻辑上较为独立的执行过程，比如编译Java源代码，拷贝文件，打包Jar文件，甚至可以是执行一个系统命令或者调用Ant。另外，一">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2019/png/215777/1556208386784-dec2456e-561a-42f6-a679-a8c47f089872.png#align=left&display=inline&height=1221&name=image.png&originHeight=1221&originWidth=587&size=231915&status=done&width=587">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://xsfelvis.github.io/2019/05/02/Gradle插件从入门到进阶/"/>





  <title>Gradle插件从入门到进阶 | 渡口一艘船</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-120283281-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2a3365c396bc1892919405bfc6ea04a8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">渡口一艘船</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">不积跬步，无以至千里；不积小流，无以成江海</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xsfelvis.github.io/2019/05/02/Gradle插件从入门到进阶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="云来">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渡口一艘船">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Gradle插件从入门到进阶</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-02T00:00:00+08:00">
                2019-05-02
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2019-05-02T23:14:17+08:00">
                2019-05-02
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Gradle插件/" itemprop="url" rel="index">
                    <span itemprop="name">Gradle插件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/05/02/Gradle插件从入门到进阶/" class="leancloud_visitors" data-flag-title="Gradle插件从入门到进阶">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  8,496
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  38
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <script src="/assets/js/APlayer.min.js"> </script><h1 id="Gradle插件从入门到进阶"><a href="#Gradle插件从入门到进阶" class="headerlink" title="Gradle插件从入门到进阶"></a>Gradle插件从入门到进阶</h1><p><a name="scdur"></a></p>
<h1 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h1><p>Gradle本身的领域对象主要有Project和Task。Project为Task提供了执行上下文，所有的Plugin要么向Project中添加用于配置的Property，要么向Project中添加不同的Task。一个Task表示一个逻辑上较为独立的执行过程，比如编译Java源代码，拷贝文件，打包Jar文件，甚至可以是执行一个系统命令或者调用Ant。另外，一个Task可以读取和设置Project的Property以完成特定的操作。<br><a name="frNjm"></a></p>
<h2 id="Groovy-基础"><a href="#Groovy-基础" class="headerlink" title="Groovy 基础"></a>Groovy 基础</h2><ul>
<li><p><a href="https://gradle.org/" target="_blank" rel="noopener">官网</a></p>
</li>
<li><p><a href="https://blog.csdn.net/yanbober/article/details/49047515" target="_blank" rel="noopener">Groovy脚本基础全攻略</a></p>
</li>
<li><a href="https://blog.csdn.net/zhaoyanjun6/article/details/70313790" target="_blank" rel="noopener">groovy使用完全解析</a></li>
<li><p><a href="https://docs.gradle.org/current/dsl/index.html" target="_blank" rel="noopener">gradle dsl 基础</a><br><a name="8ce6e53d"></a></p>
<h2 id="Android-DSL-基础"><a href="#Android-DSL-基础" class="headerlink" title="Android DSL 基础"></a>Android DSL 基础</h2></li>
<li><p><a href="http://google.github.io/android-gradle-dsl/current/index.html" target="_blank" rel="noopener">ASL</a></p>
</li>
</ul>
<p>相关代码在 <a href="https://github.com/xsfelvis/GradlePluginStudy" target="_blank" rel="noopener">https://github.com/xsfelvis/GradlePluginStudy</a></p>
<p><a name="l5q5r"></a></p>
<h1 id="2、核心概念"><a href="#2、核心概念" class="headerlink" title="2、核心概念"></a>2、核心概念</h1><p><a name="Jbmkp"></a></p>
<h2 id="Project对象"><a href="#Project对象" class="headerlink" title="Project对象"></a><a href="https://docs.gradle.org/current/javadoc/org/gradle/api/Project.html" target="_blank" rel="noopener">Project</a>对象</h2><p>自定义插件类是通过实现Plugin 接口，并将 org.gradle.api.Project作为模板参数，其中org.gradle.api.Project的实例对象将作为参数传给<code>void apply(Project project)</code>函数，根据官网，可以看出Project是与Gradle交互的主接口，通过Project可以使用gradle的所有特性，并且 Project与build.grale是一对一的关系。简而言之，就是通过代码使用Gradle，通过Project这个入口即可</p>
<p>我们对project的理解更多来源于项目目录中的<code>build.gradle</code>文件（因为它其实就是project对象的委托，在脚本中的配置方法都对应着Project中的API，当构建进程启动后Gradle基于build.gradle中的配置实例化org.gradle.api.Project类，本质上可以认为是包含多个Task的容器，所有的Task都存放在TaskContainer中，<code>Project</code>对象的类图如下所示：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556208386784-dec2456e-561a-42f6-a679-a8c47f089872.png#align=left&amp;display=inline&amp;height=1221&amp;name=image.png&amp;originHeight=1221&amp;originWidth=587&amp;size=231915&amp;status=done&amp;width=587" alt="image.png"><br><a name="RRwSQ"></a></p>
<h3 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h3><p>在build.gradle脚本文件中，我们不仅可以对单独project进行配置，也可以定义project块的共有逻辑等，参考下面的定义。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556039101293-ed67fa06-d53e-436e-9e98-3b5a8d78d851.png#align=left&amp;display=inline&amp;height=326&amp;name=image.png&amp;originHeight=382&amp;originWidth=875&amp;size=106084&amp;status=done&amp;width=746" alt="image.png"></p>
<p>常见的例子<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为所有项目添加仓库源配置</span></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">        google()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 为所有子项目添加mavenPublish的配置块</span></span><br><span class="line">subprojects &#123;</span><br><span class="line">    mavenPublish &#123;</span><br><span class="line">        groupId = maven.config.groupId</span><br><span class="line">        releaseRepo = maven.config.releaseRepo</span><br><span class="line">        snapshotRepo = maven.config.snapshotRepo</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a name="eb9j4"></a></p>
<h2 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h2><p><a href="https://docs.gradle.org/current/javadoc/org/gradle/api/Task.html" target="_blank" rel="noopener">Gradle Task API</a></p>
<p>Gradle构建脚本默认的名字是build.gradle，当在shell中执行gradle命令时，Gradle会去当前目录下寻找名字是build.gradle的文件。在Gradle中一个原子性的操作叫做task，简单理解为task是Gradle脚本中的最小可执行单元。</p>
<p>下面是task的类图。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556039163910-6ee5a942-7599-4a9c-a78a-ccf14e3d4783.png#align=left&amp;display=inline&amp;height=450&amp;name=image.png&amp;originHeight=450&amp;originWidth=702&amp;size=90267&amp;status=done&amp;width=702" alt="image.png"><br><a name="IlHJD"></a></p>
<h3 id="Task的Actions"><a href="#Task的Actions" class="headerlink" title="Task的Actions"></a>Task的Actions</h3><p>一个Task是由一序列Action组成的，当运行一个Task的时候，这个Task里的Action序列会按照顺序执行</p>
<p><a name="aeQtc"></a></p>
<h3 id="Task的几种常见写法"><a href="#Task的几种常见写法" class="headerlink" title="Task的几种常见写法"></a>Task的几种常见写法</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">task myTask1 &#123;</span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">"doLast in task1"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task myTask2 &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">"doLast in task2"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//采用 Project.task(String name) 方法来创建</span></span><br><span class="line">project.task(<span class="string">"myTask3"</span>).doLast &#123;</span><br><span class="line">    println <span class="string">"doLast in task3"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//采用 TaskContainer.create(String name) 方法来创建</span></span><br><span class="line">project.tasks.create(<span class="string">"myTask4"</span>).doLast &#123;</span><br><span class="line">    println <span class="string">"doLast in task4"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">project.tasks.create(<span class="string">"myTask5"</span>) &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">"doLast in task5"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>目前task的动作（action）声明主要包含两个方法：</p>
<ul>
<li>doFirst  等价操作 缩写 leftShift &lt;&lt;（5.0会废弃）</li>
<li>doLast</li>
</ul>
<p>在 Gradle 中定义 Task 的时候，可以指定更多的参数，如下所示：</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>含义</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>task的名字</td>
<td>必须指定，不能为空</td>
</tr>
<tr>
<td>type</td>
<td>task的父类</td>
<td>默认值为org.gradle.api.DefaultTask</td>
</tr>
<tr>
<td>overwrite</td>
<td>是否替换已经存在的同名task</td>
<td>false</td>
</tr>
<tr>
<td>group</td>
<td>task所属的分组名</td>
<td>null</td>
</tr>
<tr>
<td>description</td>
<td>task的描述</td>
<td>null</td>
</tr>
<tr>
<td>dependsOn</td>
<td>task依赖的task集合</td>
<td>无</td>
</tr>
<tr>
<td>constructorArgs</td>
<td>构造函数参数</td>
<td>无</td>
</tr>
</tbody>
</table>
<p><a name="pMxNC"></a></p>
<h3 id="Task的依赖"><a href="#Task的依赖" class="headerlink" title="Task的依赖"></a>Task的依赖</h3><p>gradle中任务的执行顺序是不确定的。通过task之间的依赖关系，gradle能够确保所依赖的task会被当前的task先执行。使用task的<code>dependsOn()</code>方法，允许我们为task声明一个或者多个task依赖。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">task first&#123;</span><br><span class="line">    doLast&#123;</span><br><span class="line">        println(<span class="string">"first"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task second&#123;</span><br><span class="line">    doLast&#123;</span><br><span class="line">        println(<span class="string">"second"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task third&#123;</span><br><span class="line">    doLast&#123;</span><br><span class="line">        println(<span class="string">"third"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task test(<span class="string">dependsOn:</span>[second,first])&#123;</span><br><span class="line">    doLast&#123;</span><br><span class="line">        println(<span class="string">"first"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">third.dependsOn(test)</span><br></pre></td></tr></table></figure>
<p>执行顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; Task :app:first </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; Task :app:second </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; Task :app:test1 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; Task :app:third</span><br></pre></td></tr></table></figure>
<p><a name="6m5Ir"></a></p>
<h3 id="Task的类型"><a href="#Task的类型" class="headerlink" title="Task的类型"></a>Task的类型</h3><p>有copy、jar、Delete 等等 可以参考Doc文档</p>
<p>task copyFile(type: Copy) {<br>   from ‘xml’<br>   into ‘destination’<br>}</p>
<p><a name="K5PMg"></a></p>
<h3 id="自定义Task"><a href="#自定义Task" class="headerlink" title="自定义Task"></a>自定义Task</h3><p> Gradle 中通过 task 关键字创建的 task，默认的父类都是 org.gradle.api.DefaultTask，这里定义了一些 task 的默认行为。看看下面这个例子：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义Task类，必须继承自DefaultTask</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SayHelloTask</span> <span class="keyword">extends</span> <span class="title">DefaultTask</span> &#123;</span></span><br><span class="line">    </span><br><span class="line">    String msg = <span class="string">"default name"</span></span><br><span class="line">    <span class="keyword">int</span> age = <span class="number">18</span>        </span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数必须用@javax.inject.Inject注解标识</span></span><br><span class="line">    <span class="meta">@javax</span>.inject.Inject</span><br><span class="line">    SayHelloTask(<span class="keyword">int</span> age) &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过@TaskAction注解来标识该Task要执行的动作</span></span><br><span class="line">    <span class="meta">@TaskAction</span></span><br><span class="line">    <span class="keyword">void</span> sayHello() &#123;</span><br><span class="line">        println <span class="string">"Hello $msg ! age is $&#123;age&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过constructorArgs参数来指定构造函数的参数值</span></span><br><span class="line">task hello1(<span class="string">type:</span> SayHelloTask, <span class="string">constructorArgs:</span> [<span class="number">30</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过type参数指定task的父类，可以在配置代码里修改父类的属性</span></span><br><span class="line">task hello2(<span class="string">type:</span> SayHelloTask, <span class="string">constructorArgs:</span> [<span class="number">18</span>]) &#123;</span><br><span class="line">        <span class="comment">//配置代码里修改 SayHelloTask 里的字段 msg 的值</span></span><br><span class="line">    msg = <span class="string">"hjy"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> <br>执行这两个task</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="string">Task :</span>hello1</span><br><span class="line">Hello <span class="keyword">default</span> name ! age is <span class="number">30</span></span><br><span class="line"></span><br><span class="line">&gt; <span class="string">Task :</span>hello2</span><br><span class="line">Hello hjy ! age is <span class="number">18</span></span><br></pre></td></tr></table></figure>
<p><br><br><a name="vRDtb"></a></p>
<h3 id="Task的类图"><a href="#Task的类图" class="headerlink" title="Task的类图"></a>Task的类图</h3><p>Gradle所说的Task是org.gradle.api.Task接口，默认实现是org.gradle.api.DefaultTask类，其类图如下<br><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556193021427-9d3cda16-11cd-4908-8f9c-aac56947ad6e.png#align=left&amp;display=inline&amp;height=806&amp;name=image.png&amp;originHeight=1081&amp;originWidth=1000&amp;size=214151&amp;status=done&amp;width=746" alt="image.png"></p>
<p><a name="eejch"></a></p>
<h3 id="TaskContainer接口解析"><a href="#TaskContainer接口解析" class="headerlink" title="TaskContainer接口解析"></a>TaskContainer接口解析</h3><p>TaskContianer 是用来管理所有的 Task 实例集合的，可以通过 Project.getTasks() 来获取 TaskContainer 实例。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">org.gradle.api.tasks.TaskContainer接口：</span><br><span class="line"><span class="comment">//查找task</span></span><br><span class="line">findByPath(<span class="string">path:</span> String): Task</span><br><span class="line">getByPath(<span class="string">path:</span> String): Task</span><br><span class="line">getByName(<span class="string">name:</span> String): Task</span><br><span class="line">withType(<span class="string">type:</span> Class): TaskCollection</span><br><span class="line">matching(<span class="string">condition:</span> Closure): TaskCollection</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建task</span></span><br><span class="line">create(<span class="string">name:</span> String): Task</span><br><span class="line">create(<span class="string">name:</span> String, <span class="string">configure:</span> Closure): Task </span><br><span class="line">create(<span class="string">name:</span> String, <span class="string">type:</span> Class): Task</span><br><span class="line">create(<span class="string">options:</span> Map&lt;String, ?&gt;): Task</span><br><span class="line">create(<span class="string">options:</span> Map&lt;String, ?&gt;, configure: Closure): Task</span><br><span class="line"></span><br><span class="line"><span class="comment">//当task被加入到TaskContainer时的监听</span></span><br><span class="line">whenTaskAdded(<span class="string">action:</span> Closure)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//当有task创建时</span></span><br><span class="line">getTasks().whenTaskAdded &#123; Task task -&gt;</span><br><span class="line">    println <span class="string">"The task $&#123;task.getName()&#125; is added to the TaskContainer"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//采用create(name: String)创建</span></span><br><span class="line">getTasks().create(<span class="string">"task1"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//采用create(options: Map&lt;String, ?&gt;)创建</span></span><br><span class="line">getTasks().create([<span class="string">name:</span> <span class="string">"task2"</span>, <span class="string">group:</span> <span class="string">"MyGroup"</span>, <span class="string">description:</span> <span class="string">"这是task2描述"</span>, <span class="string">dependsOn:</span> [<span class="string">"task1"</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment">//采用create(options: Map&lt;String, ?&gt;, configure: Closure)创建</span></span><br><span class="line">getTasks().create(<span class="string">"task3"</span>, &#123;</span><br><span class="line">    group <span class="string">"MyGroup"</span></span><br><span class="line">    setDependsOn([<span class="string">"task1"</span>, <span class="string">"task2"</span>])</span><br><span class="line">    setDescription <span class="string">"这是task3描述"</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>默认情况下，我们常见的task都是<code>org.gradle.api.DefaultTask</code>类型。但是在gradle当中有相当丰富的task类型我们可以直接使用。要更改task的类型，我们可以参考下面的示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task createDistribution(type:Zip)&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>更多关于task的类型，可以参考gradle的<a href="https://link.juejin.im?target=https%3A%2F%2Fdocs.gradle.org%2Fcurrent%2Fdsl%2Findex.html%23N10376" target="_blank" rel="noopener">官方文档</a></p>
<p><a href="https://www.jianshu.com/p/cd1a78dc8346" target="_blank" rel="noopener">https://www.jianshu.com/p/cd1a78dc8346</a><br><a href="https://www.ezlippi.com/blog/2015/07/gradle-tasks-guide.html" target="_blank" rel="noopener">https://www.ezlippi.com/blog/2015/07/gradle-tasks-guide.html</a><br><a href="https://blog.csdn.net/lzyzsd/article/details/46935405" target="_blank" rel="noopener">https://blog.csdn.net/lzyzsd/article/details/46935405</a></p>
<p><a name="vyLYu"></a></p>
<h3 id="Task的增量构建"><a href="#Task的增量构建" class="headerlink" title="Task的增量构建"></a>Task的增量构建</h3><p>Gradle 支持一种叫做 up-to-date 检查的功能，也就是常说的增量构建。Gradle 的 Task 会把每次运行的结果缓存下来，当下次运行时，会检查输出结果有没有变更，如果没有变更则跳过运行，这样可以提高 Gradle 的构建速度。<br>通常，一个 task 会有一些输入(inputs)和一些输出(outputs)，task 的输入会影响其输出结果，以官网中的一张图为例：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556205376270-23df6fcc-2d91-45ba-af71-ce6a810df505.png#align=left&amp;display=inline&amp;height=371&amp;name=image.png&amp;originHeight=497&amp;originWidth=1000&amp;size=140744&amp;status=done&amp;width=746" alt="image.png"></p>
<p>图中表示一个java编译的task，它的输入有2种，一是JDK版本号，一是源文件，它的输出结果为class文件，只要JSK版本号与源文件有任何变动，最终编译出的class文件肯定不同的。当我们执行过一次·编译任务之后，再次运行该task，如果发现他的输入没有任何改动，那么它编译后的结果肯定也是不变的，可以直接从缓存里获取输出，这样Gradle会标识该task为UP-TO-DATE,从而跳过该task的执行<br><a name="FnBef"></a></p>
<h4 id="TaskInputs、TaskOutputs介绍"><a href="#TaskInputs、TaskOutputs介绍" class="headerlink" title="TaskInputs、TaskOutputs介绍"></a>TaskInputs、TaskOutputs介绍</h4><p>如何实现一个增量构建呢，至少指定一个输入，一个输出，Task.getInputs() 对象类型为 TaskInputs，Task.getOutputs() 对象类型为 TaskOuputs，从中也可以看到inputs、outputs都支持哪些数据类型</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">task test1 &#123;</span><br><span class="line">    <span class="comment">//设置inputs</span></span><br><span class="line">    inputs.property(<span class="string">"name"</span>, <span class="string">"hjy"</span>)</span><br><span class="line">    inputs.property(<span class="string">"age"</span>, <span class="number">20</span>)</span><br><span class="line">    <span class="comment">//设置outputs</span></span><br><span class="line">    outputs.file(<span class="string">"$buildDir/test.txt"</span>)</span><br><span class="line"></span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">"exec task task1"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task test2 &#123;</span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">"exec task task2"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//第一次的运行结果</span></span><br><span class="line">&gt; <span class="string">Task :</span>test1</span><br><span class="line">exec task task1</span><br><span class="line"></span><br><span class="line">&gt; <span class="string">Task :</span>test2</span><br><span class="line">exec task task2</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL <span class="keyword">in</span> <span class="number">0</span>s</span><br><span class="line"><span class="number">2</span> actionable <span class="string">tasks:</span> <span class="number">2</span> executed</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二次的运行结果</span></span><br><span class="line">&gt; <span class="string">Task :</span>test2</span><br><span class="line">exec task task2</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL <span class="keyword">in</span> <span class="number">0</span>s</span><br><span class="line"><span class="number">2</span> actionable <span class="string">tasks:</span> <span class="number">1</span> executed, <span class="number">1</span> up-to-date</span><br></pre></td></tr></table></figure>
<p>从结果中可以看到，第2次运行时，test1 task 并没有运行，而是被标记为 up-to-date，而 test2 task 则每次都会运行，这就是典型的增量构建。<br><a name="yvIpg"></a></p>
<p>#####<br><a name="eWUON"></a></p>
<h4 id="taskInputs、taskOutputs注解"><a href="#taskInputs、taskOutputs注解" class="headerlink" title="taskInputs、taskOutputs注解"></a>taskInputs、taskOutputs注解</h4><p>可以通过task注解来实现增量构建，这是一种更加灵活方便的方式</p>
<table>
<thead>
<tr>
<th>注解名</th>
<th>属性类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Input</td>
<td>任意Serializable类型</td>
<td>一个简单的输入值</td>
</tr>
<tr>
<td>@InputFile</td>
<td>File</td>
<td>一个输入文件，不是目录</td>
</tr>
<tr>
<td>@InputDirectory</td>
<td>File</td>
<td>一个输入目录，不是文件</td>
</tr>
<tr>
<td>@InputFiles</td>
<td>Iterable<file></file></td>
<td>File列表，包含文件和目录</td>
</tr>
<tr>
<td>@OutputFile</td>
<td>File</td>
<td>一个输出文件，不是目录</td>
</tr>
<tr>
<td>@OutputDirectory</td>
<td>File</td>
<td>一个输出目录，不是文件</td>
</tr>
<tr>
<td>@OutputFiles</td>
<td>Map<string, file="">或Iterable<file></file></string,></td>
<td>输出文件列表</td>
</tr>
<tr>
<td>@OutputDirectories</td>
<td>Map<string, file="">或Iterable<file></file></string,></td>
<td>输出目录列表</td>
</tr>
</tbody>
</table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SayHelloTask</span> <span class="keyword">extends</span> <span class="title">DefaultTask</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定义输入</span></span><br><span class="line">    <span class="meta">@Input</span></span><br><span class="line">    String username;</span><br><span class="line">    <span class="meta">@Input</span></span><br><span class="line">    <span class="keyword">int</span> age</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义输出</span></span><br><span class="line">    <span class="meta">@OutputDirectory</span></span><br><span class="line">    File destDir;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TaskAction</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        println <span class="string">"Hello $username ! age is $age"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">task <span class="title">test</span><span class="params">(type: SayHelloTask)</span> </span>&#123;</span><br><span class="line">    age = <span class="number">18</span></span><br><span class="line">    username = <span class="string">"hjy"</span></span><br><span class="line">    destDir = file(<span class="string">"$buildDir/test"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="BeBdj"></a></p>
<h2 id="Property"><a href="#Property" class="headerlink" title="Property"></a>Property</h2><p><a name="tJ22i"></a></p>
<h3 id="ext命名空间"><a href="#ext命名空间" class="headerlink" title="ext命名空间"></a>ext命名空间</h3><p>Gradle中很多模型类都提供了特别的属性支持，比如<code>Project</code>.在gradle内部，这些属性会以键值对的形式存储。使用ext命名空间，我们可以方便的添加属性。下面的方式都是支持的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//在project中添加一个名为groupId的属性</span><br><span class="line">project.ext.groupId=&quot;tech.easily&quot;</span><br><span class="line">// 使用ext块添加属性</span><br><span class="line">ext&#123;</span><br><span class="line">    artifactId=&apos;EasyDependency&apos;</span><br><span class="line">    config=[</span><br><span class="line">            key:&apos;value&apos;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>值得注意的是，只有在声明属性的时候我们需要使用<code>ext</code>命名空间，在使用属性的时候，<code>ext</code>命名空间是可以省略的。</p>
</blockquote>
<p><a name="7B2XT"></a></p>
<h3 id="属性文件"><a href="#属性文件" class="headerlink" title="属性文件"></a>属性文件</h3><p>正如我们经常在Android项目中看到的，我们可以在项目的根目录下新建一个<code>gradle.properties</code>文件，并在文件中定义简单的键值对形式的属性。这些属性能够被项目中的gradle脚本所访问。如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># gradle.properties</span><br><span class="line"># 注意文件的注释是以#开头的</span><br><span class="line">groupId=tech.easily</span><br><span class="line">artifactId=EasyDependency</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure></p>
<p>有的时候，我们可能需要在代码中动态的创建属性文件并读取文件中的属性（比如自定义插件的时候），我们可以使用<code>java.util.Properties</code>类。比如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">void createPropertyFile() &#123;</span><br><span class="line">    def localPropFile = new File(it.projectDir.absolutePath + &quot;/local.properties&quot;)</span><br><span class="line">    def defaultProps = new Properties()</span><br><span class="line">    if (!localPropFile.exists()) &#123;</span><br><span class="line">        localPropFile.createNewFile()</span><br><span class="line">        defaultProps.setProperty(&quot;debuggable&quot;, &apos;true&apos;)</span><br><span class="line">        defaultProps.setProperty(&quot;groupId&quot;, GROUP)</span><br><span class="line">        defaultProps.setProperty(&quot;artifactId&quot;, project.name)</span><br><span class="line">        defaultProps.setProperty(&quot;versionName&quot;, VERSION_NAME)</span><br><span class="line">        defaultProps.store(new FileWriter(localPropFile), &quot;properties auto generated for resolve dependencies&quot;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        localPropFile.withInputStream &#123; stream -&gt;</span><br><span class="line">            defaultProps.load(stream)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>关于属性很重要的一点是属性是可以继承的。在一个项目中定义的属性会自动的被其子项目继承，不管我们是用以上哪种方式添加属性都是适用的。</strong></p>
</blockquote>
<p><a name="ksE1R"></a></p>
<h2 id="ExtensionContainer"><a href="#ExtensionContainer" class="headerlink" title="ExtensionContainer"></a>ExtensionContainer</h2><p><a name="gMdOo"></a></p>
<h3 id="Extension简介"><a href="#Extension简介" class="headerlink" title="Extension简介"></a>Extension简介</h3><p>就是 Gradle 的 Extension，翻译成中文意思就叫扩展。它的作用就是通过实现自定义的 Extension，可以在 Gradle 脚本中增加类似 android 这样命名空间的配置，Gradle 可以识别这种配置，并读取里面的配置内容。</p>
<p>一般我们通过ExtensionContainer来创建Extension，这个类跟TaskContainer命名有点类似。TaskContainer是用来创建并管理Task的，而ExtensionContainer则是用来创建并管理Extension的，通过Project的以下API可以获取到ExtensionContainer对象<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExtensionContainer getExtensions()</span><br></pre></td></tr></table></figure></p>
<p><a name="o5EOM"></a></p>
<h3 id="简单的Extension"><a href="#简单的Extension" class="headerlink" title="简单的Extension"></a>简单的Extension</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/先定义一个普通的java类，包含<span class="number">2</span>个属性</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> age</span><br><span class="line">    String username</span><br><span class="line">    String toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"name = $&#123;username&#125;, age = $&#123;age&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建一个名为 foo 的Extension</span></span><br><span class="line">getExtensions().create(<span class="string">"foo"</span>, Foo)</span><br><span class="line"><span class="comment">//配置Extension</span></span><br><span class="line">foo &#123;</span><br><span class="line">    age = <span class="number">30</span></span><br><span class="line">    username = <span class="string">"hjy"</span></span><br><span class="line">&#125;</span><br><span class="line">task testExt.doLast &#123;</span><br><span class="line">    <span class="comment">//能直接通过 project 获取到自定义的 Extension</span></span><br><span class="line">    println project.foo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>foo 就是我们自定义的 Extension 了，它里面能配置的属性与类 Foo 中的字段是一致的，在 build.gradle 中可以直接通过 project.foo 来访问。每个 Extension 实际上与某个类是相关联的，在 build.gradle 中通过 DSL 来定义，Gradle 会识别解析并生成一个对象实例，通过该类可以获取我们所配置的信息。<br> Project 有个扩展属性是通过 ext 命名空间配置的，可以看到 ext 与这里是类似的，不同的是 ext 可以配置任何键值对的属性值，而这里只能识别我们定义的 Java 类里的属性值。</p>
<p><a name="coFAz"></a></p>
<h3 id="ExtensionContainer主要api及用法"><a href="#ExtensionContainer主要api及用法" class="headerlink" title="ExtensionContainer主要api及用法"></a>ExtensionContainer主要api及用法</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; T create(String name, Class&lt;T&gt; type, Object... constructionArguments)</span><br><span class="line">&lt;T&gt; T create(Class&lt;T&gt; publicType, String name, Class&lt;? extends T&gt; instanceType, Object... constructionArguments)</span><br></pre></td></tr></table></figure>
<p>先来看看后面这个 API 所有参数的含义。</p>
<ul>
<li>publicType：创建的 Extension 实例暴露出来的类类型；</li>
<li>name：要创建的Extension的名字，可以是任意符合命名规则的字符串，不能与已有的重复，否则会抛异常；</li>
<li>instanceType：该Extension的类类型；</li>
<li>constructionArguments：类的构造函数参数值</li>
</ul>
<p>官方文档里还说明了一个特性，创建的 Extension 对象都默认实现了 ExtensionAware 接口，并注明出处。</p>
<p>示例</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> &#123;</span></span><br><span class="line">    </span><br><span class="line">    String username</span><br><span class="line">    <span class="keyword">int</span> legs</span><br><span class="line"></span><br><span class="line">    Animal(String name) &#123;</span><br><span class="line">        username = name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> setLegs(<span class="keyword">int</span> c) &#123;</span><br><span class="line">        legs = c</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"This animal is $username, it has $&#123;legs&#125; legs."</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pig</span> <span class="keyword">extends</span> <span class="title">Animal</span> &#123;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> age</span><br><span class="line">    String owner</span><br><span class="line"></span><br><span class="line">    Pig(<span class="keyword">int</span> age, String owner) &#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"Pig"</span>)</span><br><span class="line">        <span class="keyword">this</span>.age = age</span><br><span class="line">        <span class="keyword">this</span>.owner = owner</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.toString() + <span class="string">" Its age is $age, its owner is $owner."</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建的Extension是 暴露出来Animal 类型,创建extension名称是name,该extension的类型是Pig，后面2个是参数</span></span><br><span class="line">Animal aAnimal = getExtensions().create(Animal, <span class="string">"animal"</span>, Pig, <span class="number">3</span>, <span class="string">"hjy"</span>)</span><br><span class="line"><span class="comment">//创建的Extension是 Pig 类型</span></span><br><span class="line">Pig aPig = getExtensions().create(<span class="string">"pig"</span>, Pig, <span class="number">5</span>, <span class="string">"kobe"</span>)</span><br><span class="line"></span><br><span class="line">animal &#123;</span><br><span class="line">    legs = <span class="number">4</span>    <span class="comment">//配置属性</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pig &#123;</span><br><span class="line">    setLegs <span class="number">2</span>   <span class="comment">//这个是方法调用，也就是 setLegs(2)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task testExt &lt;&lt; &#123;</span><br><span class="line">    println aAnimal</span><br><span class="line">    println aPig</span><br><span class="line">    <span class="comment">//验证 aPig 对象是 ExtensionAware 类型的</span></span><br><span class="line">    println <span class="string">"aPig is a instance of ExtensionAware : $&#123;aPig instanceof ExtensionAware&#125;"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a name="ZCEZN"></a></p>
<h3 id="增加Extension"><a href="#增加Extension" class="headerlink" title="增加Extension"></a>增加Extension</h3><ul>
<li>create() 方法会创建并返回一个 Extension 对象，</li>
<li>add() 方法，唯一的差别是它并不会返回一个 Extension 对象</li>
</ul>
<p>基于前面的这个实例，我们可以换一种写法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">getExtensions().add(Pig, &quot;mypig&quot;, new Pig(5, &quot;kobe&quot;))</span><br><span class="line">mypig &#123;</span><br><span class="line">    username = &quot;MyPig&quot;</span><br><span class="line">    legs = 4</span><br><span class="line">    age = 1</span><br><span class="line">&#125;</span><br><span class="line">task testExt &lt;&lt; &#123;</span><br><span class="line">    def aPig = project.getExtensions().getByName(&quot;mypig&quot;)</span><br><span class="line">    println aPig</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a name="ZGXZe"></a></p>
<h3 id="查找Extension"><a href="#查找Extension" class="headerlink" title="查找Extension"></a>查找Extension</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Object findByName(String name)</span><br><span class="line">&lt;T&gt; T findByType(Class&lt;T&gt; type)</span><br><span class="line">Object getByName(String name)       //找不到会抛异常</span><br><span class="line">&lt;T&gt; T getByType(Class&lt;T&gt; type)  //找不到会抛异常</span><br></pre></td></tr></table></figure>
<p><a name="y6SZf"></a></p>
<h3 id="嵌套Extension-方式一"><a href="#嵌套Extension-方式一" class="headerlink" title="嵌套Extension 方式一"></a>嵌套Extension 方式一</h3><p>类似下面这样的配置应该随处可见：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">outer &#123;</span><br><span class="line">    </span><br><span class="line">    outerName &quot;outer&quot;</span><br><span class="line">    msg &quot;this is a outer message.&quot;</span><br><span class="line">    inner &#123;</span><br><span class="line">        innerName &quot;inner&quot;</span><br><span class="line">        msg &quot;This is a inner message.&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以通过下面的方式来创建</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OuterExt</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    String outerName</span><br><span class="line">    String msg</span><br><span class="line">    InnerExt innerExt = <span class="keyword">new</span> InnerExt()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">outerName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        outerName = name</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">msg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建内部Extension，名称为方法名 inner</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inner</span><span class="params">(Action&lt;InnerExt&gt; action)</span> </span>&#123;</span><br><span class="line">        action.execute(inner)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建内部Extension，名称为方法名 inner</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inner</span><span class="params">(Closure c)</span> </span>&#123;</span><br><span class="line">        org.gradle.util.ConfigureUtil.configure(c, innerExt) </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"OuterExt[ name = $&#123;outerName&#125;, msg = $&#123;msg&#125;] "</span> + innerExt</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InnerExt</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    String innerName</span><br><span class="line">    String msg</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">innerName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        innerName = name</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">msg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"InnerExt[ name = $&#123;innerName&#125;, msg = $&#123;msg&#125;]"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def outExt = getExtensions().create(<span class="string">"outer"</span>, OuterExt)</span><br><span class="line"></span><br><span class="line">outer &#123;</span><br><span class="line">    </span><br><span class="line">    outerName <span class="string">"outer"</span></span><br><span class="line">    msg <span class="string">"this is a outer message."</span></span><br><span class="line"></span><br><span class="line">    inner &#123;</span><br><span class="line">        innerName <span class="string">"inner"</span></span><br><span class="line">        msg <span class="string">"This is a inner message."</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task testExt doLast &#123;</span><br><span class="line">    println outExt</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关键在以下下面的方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">void inner(Action&lt;InnerExt&gt; action)</span><br><span class="line">void inner(Closure c)</span><br></pre></td></tr></table></figure></p>
<p>定义在outer内部的inner,Gradle 解析时本质上会调用 outer.inner(……)方法，该方法的参数是一个闭包(Script Block) 所以在类OuterExt中必须定义inner方法</p>
<p><a name="AFMCp"></a></p>
<h3 id="嵌套Extension方式二-NamedDomainObjectContainer"><a href="#嵌套Extension方式二-NamedDomainObjectContainer" class="headerlink" title="嵌套Extension方式二(NamedDomainObjectContainer)"></a>嵌套Extension方式二(NamedDomainObjectContainer)</h3><p><a name="LOQa2"></a></p>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><p>Gradle Extension 的时候，说到名为 android 的 Extension 是由 BaseExtension 这个类来实现的，里面对 buildTypes 是这样定义的：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> NamedDomainObjectContainer&lt;BuildType&gt; buildTypes;</span><br></pre></td></tr></table></figure></p>
<p>buildTypes 就是 NamedDomainObjectContainer 类型的，先来看看 buildTypes 在 Android 中是怎么使用的，下面这段代码应该都很熟悉了，它定义了 debug、relase 两种打包模式：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            <span class="comment">// 是否开启混淆</span></span><br><span class="line">            minifyEnabled <span class="literal">true</span></span><br><span class="line">            <span class="comment">// 开启ZipAlign优化</span></span><br><span class="line">            zipAlignEnabled <span class="literal">true</span></span><br><span class="line">            <span class="comment">//去掉不用资源</span></span><br><span class="line">            shrinkResources <span class="literal">true</span></span><br><span class="line">            <span class="comment">// 混淆文件位置</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">            <span class="comment">// 使用release签名</span></span><br><span class="line">            signingConfig signingConfigs.hmiou</span><br><span class="line">        &#125;</span><br><span class="line">        debug &#123;</span><br><span class="line">            signingConfig signingConfigs.hmiou</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当我们新建一个项目时候，默认会有debug和release这2个配置，那么debug、release可以修改其他名字吗，能增加其他名字来配置吗，比如想增加一个测试包配置test，还有就是release里面都能配置哪些属性呢<br>我来说下结果，如果不确定的，可以实际验证一下：</p>
<ul>
<li>debug、release 是可以修改成其他名字的，你可以替换成你喜欢的名字；</li>
<li>你可以增加任意不同名字的配置，比如增加一个开发版本的打包配置 dev ；</li>
<li>可配置的属性可参考接口：com.android.builder.model.BuildType ；</li>
</ul>
<p>可以看到它是非常灵活的，<strong>可以根据不同的场景定义不同的配置，每个不同的命名空间都会生成一个 BuildType 配置</strong>。要实现这样的功能，必须使用 NamedDomainObjectContainer 类型。</p>
<p><a name="Nakno"></a></p>
<h4 id="什么是NamedDomainObjectContainer"><a href="#什么是NamedDomainObjectContainer" class="headerlink" title="什么是NamedDomainObjectContainer"></a>什么是NamedDomainObjectContainer</h4><p>顾名思义就是命名领域对象容器，它的主要功能有：</p>
<ul>
<li>通过DSL创建指定type的对象实例</li>
<li>指定的type必须有一个public构造函数，且必须带有一个String name的参数</li>
<li>它是一个实现了SortedSet接口的容器，所以所有领域对象的name属性都必须是唯一的,在容器内部会用name属性来排序</li>
</ul>
<blockquote>
<p>named domain object container is a specialisation of NamedDomainObjectSet that adds the ability to create instances of the element type.<br>Note that a container is an implementation of SortedSet, which means that the container is guaranteed to only contain elements with unique names within this container. Furthermore, items are ordered by their name.</p>
</blockquote>
<p><a name="tjza8"></a></p>
<h4 id="创建NamedDomainObjectContainer"><a href="#创建NamedDomainObjectContainer" class="headerlink" title="创建NamedDomainObjectContainer"></a>创建NamedDomainObjectContainer</h4><p>NamedDomainObjectContainer 需要通过 Project.container(…) API 来创建，其定义为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; NamedDomainObjectContainer&lt;T&gt; container(Class&lt;T&gt; type)</span><br><span class="line">&lt;T&gt; NamedDomainObjectContainer&lt;T&gt; container(Class&lt;T&gt; type, NamedDomainObjectFactory&lt;T&gt; factory)</span><br><span class="line">&lt;T&gt; NamedDomainObjectContainer&lt;T&gt; container(java.lang.Class&lt;T&gt; type, Closure factoryClosure</span><br></pre></td></tr></table></figure></p>
<p>来看个具体的实例：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这是领域对象类型定义</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDomainObj</span> &#123;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//必须定义一个 name 属性，并且这个属性值初始化以后不要修改</span></span><br><span class="line">    String name</span><br><span class="line"></span><br><span class="line">    String msg</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数必须有一个 name 参数</span></span><br><span class="line">    <span class="keyword">public</span> TestDomainObj(String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> msg(String msg) &#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"name = $&#123;name&#125;, msg = $&#123;msg&#125;"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个扩展</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestExtension</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义一个 NamedDomainObjectContainer 属性</span></span><br><span class="line">    NamedDomainObjectContainer&lt;TestDomainObj&gt; testDomains</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> TestExtension(Project project) &#123;</span><br><span class="line">        <span class="comment">//通过 project.container(...) 方法创建 NamedDomainObjectContainer </span></span><br><span class="line">        NamedDomainObjectContainer&lt;TestDomainObj&gt; domainObjs = project.container(TestDomainObj)</span><br><span class="line">        testDomains = domainObjs</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//让其支持 Gradle DSL 语法</span></span><br><span class="line">    <span class="keyword">void</span> testDomain(Action&lt;NamedDomainObjectContainer&lt;TestDomainObj&gt;&gt; action) &#123;</span><br><span class="line">        action.execute(testDomains)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> test() &#123;</span><br><span class="line">        <span class="comment">//遍历命名领域对象容器，打印出所有的领域对象值</span></span><br><span class="line">        testDomains.all &#123; data -&gt;</span><br><span class="line">            println data        </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个名为 test 的 Extension</span></span><br><span class="line"><span class="keyword">def</span> testExt = getExtensions().create(<span class="string">"test"</span>, TestExtension, project)</span><br><span class="line"></span><br><span class="line">test &#123;</span><br><span class="line">    testDomain &#123;</span><br><span class="line">        domain2 &#123;</span><br><span class="line">            msg <span class="string">"This is domain2"</span></span><br><span class="line">        &#125;</span><br><span class="line">        domain1 &#123;</span><br><span class="line">            msg <span class="string">"This is domain1"</span></span><br><span class="line">        &#125;</span><br><span class="line">        domain3 &#123;</span><br><span class="line">            msg <span class="string">"This is domain3"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task myTask doLast &#123;</span><br><span class="line">    testExt.test()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果如下：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name = domain1, msg = This is domain1</span><br><span class="line">name = domain2, msg = This is domain2</span><br><span class="line">name = domain3, msg = This is domain3</span><br></pre></td></tr></table></figure></p>
<p><a name="s3BYi"></a></p>
<h4 id="查找和遍历"><a href="#查找和遍历" class="headerlink" title="查找和遍历"></a>查找和遍历</h4><p>NamedDomainObjectContainer 既然是一个容器类，与之相应的必然会有查找容器里的元素和遍历容器的方法：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//遍历</span></span><br><span class="line"><span class="keyword">void</span> all(Closure action)</span><br><span class="line"><span class="comment">//查找</span></span><br><span class="line">&lt;T&gt; T getByName(String name)</span><br><span class="line"><span class="comment">//查找</span></span><br><span class="line">&lt;T&gt; T findByName(String name)</span><br></pre></td></tr></table></figure></p>
<p>还是接着前面的例子：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过名字查找</span></span><br><span class="line">TestDomainObj testData = testDomains.getByName(<span class="string">"domain2"</span>)</span><br><span class="line">println <span class="string">"getByName: $&#123;testData&#125;"</span></span><br><span class="line"><span class="comment">//遍历命名领域对象容器，打印出所有的领域对象值</span></span><br><span class="line">testDomains.all &#123; data -&gt;</span><br><span class="line">    println data        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>需要注意的是，Gradle 中有很多容器类的迭代遍历方法有 each(Closure action)、all(Closure action)，但是一般我们都会用 all(…) 来进行容器的迭代。all(…) 迭代方法的特别之处是，不管是容器内已存在的元素，还是后续任何时刻加进去的元素，都会进行遍历。</p>
<p><a name="DQ1C1"></a></p>
<h3 id="Android的Extension"><a href="#Android的Extension" class="headerlink" title="Android的Extension"></a>Android的Extension</h3><p>我们在gradle中会看到 android{}<br><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556265446764-f824db8c-0d7f-4a36-b9ac-5c2dac1725d5.png#align=left&amp;display=inline&amp;height=242&amp;name=image.png&amp;originHeight=483&amp;originWidth=1000&amp;size=213329&amp;status=done&amp;width=500" alt="image.png"></p>
<p>defaultConfig、productFlavors、signingConfigs、buildTypes 这4个内部 Extension对象是怎么定义的，通过查看源码可以找到一个叫 <strong>BaseExtension</strong> 的类，里面的相关代码如下：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> DefaultConfig defaultConfig;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NamedDomainObjectContainer&lt;ProductFlavor&gt; productFlavors;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NamedDomainObjectContainer&lt;BuildType&gt; buildTypes;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NamedDomainObjectContainer&lt;SigningConfig&gt; signingConfigs;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> defaultConfig(Action&lt;DefaultConfig&gt; action) &#123;</span><br><span class="line">        <span class="keyword">this</span>.checkWritability();</span><br><span class="line">        action.execute(<span class="keyword">this</span>.defaultConfig);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> buildTypes(Action&lt;? super NamedDomainObjectContainer&lt;BuildType&gt;&gt; action) &#123;</span><br><span class="line">        this.checkWritability();</span><br><span class="line">        action.execute(this.buildTypes);</span><br><span class="line">    &#125;</span><br><span class="line">    public void productFlavors(Action&lt;? super NamedDomainObjectContainer&lt;ProductFlavor&gt;&gt; action) &#123;</span><br><span class="line">        this.checkWritability();</span><br><span class="line">        action.execute(this.productFlavors);</span><br><span class="line">    &#125;</span><br><span class="line">    public void signingConfigs(Action&lt;? super NamedDomainObjectContainer&lt;SigningConfig&gt;&gt; action) &#123;</span><br><span class="line">        this.checkWritability();</span><br><span class="line">        action.execute(this.signingConfigs);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>在 app 的 build.gradle 里我们通常会采用插件 <strong>apply plugin: ‘com.android.application’</strong> ，而在 library module 中则采用插件 <strong>apply plugin: ‘com.android.library’,AppPlugin</strong> 就是插件 <strong>com.android.application</strong> 的实现类，<strong>LibraryPlugin</strong> 则是插件 <strong>com.android.library</strong> 的实现类，接着再看看 AppPlugin 里是怎样创建 Extension 的：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppPlugin</span> <span class="keyword">extends</span> <span class="title">BasePlugin</span> <span class="keyword">implements</span> <span class="title">Plugin</span>&lt;<span class="title">Project</span>&gt; &#123;</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> AppPlugin(Instantiator instantiator, ToolingModelBuilderRegistry registry) &#123;</span><br><span class="line">        <span class="keyword">super</span>(instantiator, registry);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> BaseExtension createExtension(Project project, ProjectOptions projectOptions, Instantiator instantiator, AndroidBuilder androidBuilder, SdkHandler sdkHandler, NamedDomainObjectContainer&lt;BuildType&gt; buildTypeContainer, NamedDomainObjectContainer&lt;ProductFlavor&gt; productFlavorContainer, NamedDomainObjectContainer&lt;SigningConfig&gt; signingConfigContainer, NamedDomainObjectContainer&lt;BaseVariantOutput&gt; buildOutputs, ExtraModelInfo extraModelInfo) &#123;</span><br><span class="line">        <span class="keyword">return</span> (BaseExtension)project.getExtensions().create(<span class="string">"android"</span>, AppExtension.<span class="keyword">class</span>, <span class="keyword">new</span> Object[]&#123;project, projectOptions, instantiator, androidBuilder, sdkHandler, buildTypeContainer, productFlavorContainer, signingConfigContainer, buildOutputs, extraModelInfo&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> apply(Project project) &#123;</span><br><span class="line">        <span class="keyword">super</span>.apply(project);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//省略...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在 createExtension() 方法中，可以看到创建了一个名为 android 的 Extension，该 Extension 的类型为 AppExtension，而 AppExtension 的继承结构为 AppExtension -&gt; TestedExtension -&gt; BaseExtension，所以它的实现逻辑大部分都是在 BaseExtension 里实现的。</p>
<p>在Android 工程中的build.gradle 文件中,我们配置相关信息使用 android{} 节点,从 AppPlugin 也能看出其 Extension的名称为 android ,所以获取方法如下:</p>
<ul>
<li>project.extensions.getByName</li>
<li>project.extensions.getByType</li>
</ul>
<p><br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def getInfo() &#123;</span><br><span class="line">		//或者 直接 project.android</span><br><span class="line">    BaseExtension extension = project.extensions.getByName(&quot;android&quot;)</span><br><span class="line">    def android = project.extensions.getByType(AppExtension)</span><br><span class="line">    project.android</span><br><span class="line">    </span><br><span class="line">    println &quot;buildToolsVersion:$&#123;extension.buildToolsVersion&#125;&quot;</span><br><span class="line">    println &quot;compileSdkVersion:$&#123;extension.getCompileSdkVersion()&#125;&quot;</span><br><span class="line">    println &quot;applicationId:$&#123;extension.defaultConfig.applicationId&#125;&quot;</span><br><span class="line">    println &quot;minSdkVersion:$&#123;extension.defaultConfig.minSdkVersion&#125;&quot;</span><br><span class="line">    println &quot;targetSdkVersion:$&#123;extension.defaultConfig.targetSdkVersion&#125;&quot;</span><br><span class="line">    println &quot;versionCode:$&#123;extension.defaultConfig.versionCode&#125;&quot;</span><br><span class="line">    println &quot;versionName:$&#123;extension.defaultConfig.versionName&#125;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>更详细的请参考 </p>
<ul>
<li><a href="http://google.github.io/android-gradle-dsl/current/index.html" target="_blank" rel="noopener">ASL</a><br><a name="apKmL"></a><h1 id="3、构建生命周期"><a href="#3、构建生命周期" class="headerlink" title="3、构建生命周期"></a>3、构建生命周期</h1></li>
</ul>
<p><a name="6743b681"></a></p>
<h3 id="三个阶段"><a href="#三个阶段" class="headerlink" title="三个阶段"></a>三个阶段</h3><p>每次构建的<strong>本质其实就是执行一系列的Task</strong>，某些Task可能依赖其他Task，那些没有依赖的Task总会被最先执行，而且每个Task只会被执行一遍，每次构建的依赖关系是在构建的配置阶段确定的，在gradle构建中，构建的生命周期主要包括以下三个阶段：</p>
<ul>
<li><strong>初始化（Initialization）</strong></li>
</ul>
<p>构建工具会根据每个build.gradle文件创建出一个Project实例，初始化阶段会执行项目根目录下的Settings.gradle文件，来分析哪些项目参与构建</p>
<blockquote>
<p>include ‘:app’<br>include ‘:libraries:someProject’</p>
</blockquote>
<ul>
<li><strong>配置（Configuration）</strong></li>
</ul>
<p>这个阶段通过执行构建脚本来为每个project创建并分配Task。配置阶段会去加载所有参与构建的项目的build.gradle文件，会将build.gradle文件实例化为一个Gradle的project对象，然后分析project之间的依赖关系，下载依赖文件，分析project下的task之间的依赖关系<br><br><br></p>
<ul>
<li><strong>执行（Execution）</strong></li>
</ul>
<p>这是Task真正被执行的阶段，Gradle会根据依赖关系决定哪些Task需要被执行，以及执行的先后顺序。<br>task是Gradle中的最小执行单元，我们所有的构建，编译，打包，debug，test等都是执行了某一个task，一个project可以有多个task，task之间可以互相依赖。例如我有两个task，taskA和taskB，指定taskA依赖taskB，然后执行taskA，这时会先去执行taskB，taskB执行完毕后在执行taskA。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556187110722-537b15e2-6470-443b-b4d1-ac1e6bd1cbaf.png#align=left&amp;display=inline&amp;height=275&amp;name=image.png&amp;originHeight=275&amp;originWidth=727&amp;size=81528&amp;status=done&amp;width=727" alt="image.png"><br>在根目录和app目录下的build.gradle中会引用下面的插件</p>
<p>dependencies {<br>        classpath ‘com.android.tools.build:gradle:2.2.2’<br>    }</p>
<p>apply plugin: ‘com.android.application’</p>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556371938551-daac116f-1a1c-4d09-bf3f-417540040dd9.png#align=left&amp;display=inline&amp;height=391&amp;name=image.png&amp;originHeight=599&amp;originWidth=388&amp;size=182758&amp;status=done&amp;width=253" alt="image.png"><br><a name="uE3w6"></a></p>
<p>###<br><a name="lFk5D"></a></p>
<h3 id="Android-三个文件重要的gradle"><a href="#Android-三个文件重要的gradle" class="headerlink" title="Android 三个文件重要的gradle"></a>Android 三个文件重要的gradle</h3><p>Gradle项目有3个重要的文件需要深入理解：</p>
<ul>
<li>settings.gradle </li>
</ul>
<p>settings.gradle 文件会在构建的 initialization 阶段被执行，它用于告诉构建系统哪些模块需要包含到构建过程中。对于单模块项目， settings.gradle 文件不是必需的。对于多模块项目，如果没有该文件，构建系统就不能知道该用到哪些模块。</p>
<ul>
<li>项目根目录的 build.gradle </li>
</ul>
<p>项目根目录的 build.gradle 文件用来配置针对所有模块的一些属性。它默认包含2个代码块：buildscript{…}和allprojects{…}。前者用于配置构建脚本所用到的代码库和依赖关系，后者用于定义所有模块需要用到的一些公共属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath &apos;com.android.tools.build:gradle:2.3.2&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task clean(type: Delete) &#123;</span><br><span class="line">    delete rootProject.buildDir</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>buildscript：定义了 Android 编译工具的类路径。repositories中, jCenter是一个著名的 Maven 仓库。<br>allprojects:中定义的属性会被应用到所有 moudle 中，但是为了保证每个项目的独立性，我们一般不会在这里面操作太多共有的东西。</p>
<ul>
<li>模块目录的 build.gradle 。</li>
</ul>
<p>模块级配置文件 build.gradle 针对每个moudle 的配置，如果这里的定义的选项和顶层 build.gradle定义的相同。它有3个重要的代码块：plugin，android 和 dependencies。</p>
<p><a name="XbmTU"></a></p>
<h3 id="常用gradle命令"><a href="#常用gradle命令" class="headerlink" title="常用gradle命令"></a>常用gradle命令</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构建</span></span><br><span class="line">gradlew <span class="string">app:</span>clean    <span class="comment">//移除所有的编译输出文件，比如apk</span></span><br><span class="line"></span><br><span class="line">gradlew <span class="string">app:</span>build   <span class="comment">//构建 app module ，构建任务，相当于同时执行了check任务和assemble任务</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//检测</span></span><br><span class="line">gradlew <span class="string">app:</span>check   <span class="comment">//执行lint检测编译。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//打包</span></span><br><span class="line">gradlew <span class="string">app:</span>assemble <span class="comment">//可以编译出release包和debug包，可以使用gradlew assembleRelease或者gradlew assembleDebug来单独编译一种包</span></span><br><span class="line"></span><br><span class="line">gradlew <span class="string">app:</span>assembleRelease  <span class="comment">//app module 打 release 包</span></span><br><span class="line"></span><br><span class="line">gradlew <span class="string">app:</span>assembleDebug  <span class="comment">//app module 打 debug 包</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//安装，卸载</span></span><br><span class="line"></span><br><span class="line">gradlew <span class="string">app:</span>installDebug  <span class="comment">//安装 app 的 debug 包到手机上</span></span><br><span class="line"></span><br><span class="line">gradlew <span class="string">app:</span>uninstallDebug  <span class="comment">//卸载手机上 app 的 debug 包</span></span><br><span class="line"></span><br><span class="line">gradlew <span class="string">app:</span>uninstallRelease  <span class="comment">//卸载手机上 app 的 release 包</span></span><br><span class="line"></span><br><span class="line">gradlew <span class="string">app:</span>uninstallAll  <span class="comment">//卸载手机上所有 app 的包</span></span><br></pre></td></tr></table></figure>
<p><a name="aTKQj"></a></p>
<h3 id="监听生命周期"><a href="#监听生命周期" class="headerlink" title="监听生命周期"></a>监听生命周期</h3><p>在gradle的构建过程中，gradle为我们提供了非常丰富的钩子，帮助我们针对项目的需求定制构建的逻辑，如下图所示：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556078731941-534fb4b2-30f5-4b99-92c9-5ae4fc9a5e58.png#align=left&amp;display=inline&amp;height=205&amp;name=image.png&amp;originHeight=205&amp;originWidth=730&amp;size=56119&amp;status=done&amp;width=730" alt="image.png"></p>
<p>要监听这些生命周期，主要有两种方式：</p>
<ul>
<li>添加监听器</li>
<li>使用钩子的配置块</li>
</ul>
<p>关于可用的钩子可以参考<code>Gradle</code>和<code>Project</code>中的定义，常用的钩子包括：<br><a name="Gradle"></a></p>
<p>####<br><a name="uk5Bg"></a></p>
<h4 id="Project"><a href="#Project" class="headerlink" title="Project"></a>Project</h4><p>Project提供的生命周期回调方法有</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在 Project 进行配置前调用</span></span><br><span class="line"><span class="keyword">void</span> beforeEvaluate(Closure closure)</span><br><span class="line"><span class="comment">//在 Project 配置结束后调用</span></span><br><span class="line"><span class="keyword">void</span> afterEvaluate(Closure closure)</span><br></pre></td></tr></table></figure>
<p>beforeEvaluate 必须在父模块的 build.gradle 对子模块进行配置才能生效，因为在当前模块的 build.gradle 中配置，它自己本身都没配置好，所以不会监听到。</p>
<p>settings.gradle 代码：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include <span class="string">":app"</span></span><br></pre></td></tr></table></figure></p>
<p>build.gradle 代码：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对子模块进行配置</span></span><br><span class="line">subprojects &#123; sub -&gt;</span><br><span class="line">    sub.beforeEvaluate &#123; proj -&gt;</span><br><span class="line">        println <span class="string">"子项目beforeEvaluate回调..."</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">println <span class="string">"根项目配置开始---"</span></span><br><span class="line">task rootTest &#123;</span><br><span class="line">    println <span class="string">"根项目里任务配置---"</span></span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">"执行根项目任务..."</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">println <span class="string">"根项目配置结束---"</span></span><br></pre></td></tr></table></figure></p>
<p>app/build.gradle 代码：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">println <span class="string">"APP子项目配置开始---"</span></span><br><span class="line">afterEvaluate &#123;</span><br><span class="line">    println <span class="string">"APP子项目afterEvaluate回调..."</span></span><br><span class="line">&#125;</span><br><span class="line">task appTest &#123;</span><br><span class="line">    println <span class="string">"APP子项目里任务配置---"</span></span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">"执行子项目任务..."</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">println <span class="string">"APP子项目配置结束---"</span></span><br></pre></td></tr></table></figure></p>
<p>在根目录执行：gradle -q，结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">根项目配置开始---</span><br><span class="line">根项目里任务配置---</span><br><span class="line">根项目配置结束---</span><br><span class="line">子项目beforeEvaluate回调...</span><br><span class="line">APP子项目配置开始---</span><br><span class="line">APP子项目里任务配置---</span><br><span class="line">APP子项目配置结束---</span><br><span class="line">APP子项目afterEvaluate回调...</span><br></pre></td></tr></table></figure></p>
<p>project.android 获取到<a href="http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.AppExtension.html" target="_blank" rel="noopener"><code>AppExtension</code></a>:</p>
<p><a name="8ibti"></a></p>
<p>####<br><a name="MJ5Zh"></a></p>
<p>####<br><a name="sklTv"></a></p>
<h4 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h4><p>Gradle 提供的生命周期回调方法很多，部分与 Project 里的功能雷同：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在project进行配置前调用，child project必须在root project中设置才会生效，root project必须在settings.gradle中设置才会生效</span></span><br><span class="line"><span class="keyword">void</span> beforeProject(Closure closure)</span><br><span class="line"><span class="comment">//在project配置后调用</span></span><br><span class="line">afterProject(Closure closure)</span><br><span class="line"><span class="comment">//构建开始前调用</span></span><br><span class="line"><span class="keyword">void</span> buildStarted(Closure closure)</span><br><span class="line"><span class="comment">//构建结束后调用</span></span><br><span class="line"><span class="keyword">void</span> buildFinished(Closure closure)</span><br><span class="line"><span class="comment">//所有project配置完成后调用</span></span><br><span class="line"><span class="keyword">void</span> projectsEvaluated(Closure closure)</span><br><span class="line"><span class="comment">//当settings.gradle中引入的所有project都被创建好后调用，只在该文件设置才会生效</span></span><br><span class="line"><span class="keyword">void</span> projectsLoaded(Closure closure)</span><br><span class="line"><span class="comment">//settings.gradle配置完后调用，只对settings.gradle设置生效</span></span><br><span class="line"><span class="keyword">void</span> settingsEvaluated(Closure closure)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>beforeProject()/afterProject()<br>等同于<code>Project</code>中的<code>beforeEvaluate</code>和<code>afterEvaluate</code></li>
<li>settingsEvaluated()<br>settings脚本被执行完毕，<code>Settings</code>对象配置完毕</li>
<li>projectsLoaded()<br>所有参与构建的项目都从settings中创建完毕</li>
<li>projectsEvaluated()<br>所有参与构建的项目都已经被评估完</li>
</ul>
<p>我们修改 setting.gradle 的代码如下：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">gradle.settingsEvaluated &#123;</span><br><span class="line">    println <span class="string">"settings：执行settingsEvaluated..."</span></span><br><span class="line">&#125;</span><br><span class="line">gradle.projectsLoaded &#123;</span><br><span class="line">    println <span class="string">"settings：执行projectsLoaded..."</span></span><br><span class="line">&#125;</span><br><span class="line">gradle.projectsEvaluated &#123;</span><br><span class="line">    println <span class="string">"settings: 执行projectsEvaluated..."</span></span><br><span class="line">&#125;</span><br><span class="line">gradle.beforeProject &#123; proj -&gt;</span><br><span class="line">    println <span class="string">"settings：执行$&#123;proj.name&#125; beforeProject"</span></span><br><span class="line">&#125;</span><br><span class="line">gradle.afterProject &#123; proj -&gt;</span><br><span class="line">    println <span class="string">"settings：执行$&#123;proj.name&#125; afterProject"</span></span><br><span class="line">&#125;</span><br><span class="line">gradle.buildStarted &#123;</span><br><span class="line">    println <span class="string">"构建开始..."</span></span><br><span class="line">&#125;</span><br><span class="line">gradle.buildFinished &#123;</span><br><span class="line">    println <span class="string">"构建结束..."</span></span><br><span class="line">&#125;</span><br><span class="line">include <span class="string">":app"</span></span><br></pre></td></tr></table></figure></p>
<p>这个时候的执行结果如下：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">settings：执行settingsEvaluated...</span><br><span class="line">settings：执行projectsLoaded...</span><br><span class="line">settings：执行test beforeProject</span><br><span class="line">根项目配置开始---</span><br><span class="line">根项目里任务配置---</span><br><span class="line">根项目配置结束---</span><br><span class="line">settings：执行test afterProject</span><br><span class="line">settings：执行app beforeProject</span><br><span class="line">子项目beforeEvaluate回调...</span><br><span class="line">APP子项目配置开始---</span><br><span class="line">APP子项目里任务配置---</span><br><span class="line">APP子项目配置结束---</span><br><span class="line">settings：执行app afterProject</span><br><span class="line">APP子项目afterEvaluate回调...</span><br><span class="line"><span class="string">settings:</span> 执行projectsEvaluated...</span><br><span class="line">构建结束...</span><br></pre></td></tr></table></figure></p>
<p>可以看到 gradle.beforeProject 与 project.beforeEvaluate 是类似的，同样 afterProject 与 afterEvaluate 也是类似的。</p>
<p>除此之外，Gradle 还有一个通用的设置生命周期监听器的方法：<strong>addListener</strong><br><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556294955734-077629bb-f1c0-4edf-a849-6bad29cb7e73.png#align=left&amp;display=inline&amp;height=322&amp;name=image.png&amp;originHeight=643&amp;originWidth=1000&amp;size=373331&amp;status=done&amp;width=500" alt="image.png"><br>上面的 BuildListener、ProjectEvaluationListener 等与前面的部分 API 功能是一致的，这里不再赘述了。<br><a name="TaskExecutionGraph"></a></p>
<p>####<br><a name="dZ3JG"></a></p>
<h4 id="TaskExecutionGraph-Task执行图"><a href="#TaskExecutionGraph-Task执行图" class="headerlink" title="TaskExecutionGraph(Task执行图)"></a>TaskExecutionGraph(Task执行图)</h4><p>Gradle 在配置完成后，会对所有的 task 生成一个有向无环图，这里叫做 task 执行图，他们决定了 task 的执行顺序等。同样，Gradle 可以对 task 的执行生命周期进行监听。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//任务执行前掉用</span><br><span class="line">void afterTask(Closure closure)</span><br><span class="line">//任务执行后调用</span><br><span class="line">void beforeTask(Closure closure)</span><br><span class="line">//所有需要被执行的task已经task之间的依赖关系都已经确立</span><br><span class="line">void whenReady(Closure closure)</span><br></pre></td></tr></table></figure></p>
<p>通过 gradle.getTaskGraph() 方法来获取 task 执行图：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">TaskExecutionGraph taskGraph = gradle.getTaskGraph()</span><br><span class="line">taskGraph.whenReady &#123;</span><br><span class="line">    println &quot;task whenReady&quot;</span><br><span class="line">&#125;</span><br><span class="line">taskGraph.beforeTask &#123; Task task -&gt;</span><br><span class="line">    println &quot;任务名称：$&#123;task.name&#125; beforeTask&quot;</span><br><span class="line">&#125;</span><br><span class="line">taskGraph.afterTask &#123; Task task -&gt;</span><br><span class="line">    println &quot;任务名称：$&#123;task.name&#125; afterTask&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>生命周期回调的执行顺序：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gradle.settingsEvaluated-&gt;</span><br><span class="line">gradle.projectsLoaded-&gt;</span><br><span class="line">gradle.beforeProject-&gt;</span><br><span class="line">project.beforeEvaluate-&gt;</span><br><span class="line">gradle.afterProject-&gt;</span><br><span class="line">project.afterEvaluate-&gt;</span><br><span class="line">gradle.projectsEvaluated-&gt;</span><br><span class="line">gradle.taskGraph.graphPopulated-&gt;</span><br><span class="line">gradle.taskGraph.whenReady-&gt;</span><br><span class="line">gradle.buildFinished</span><br></pre></td></tr></table></figure></p>
<p><a name="o5gjg"></a></p>
<h1 id="4、自定义插件开发"><a href="#4、自定义插件开发" class="headerlink" title="4、自定义插件开发"></a>4、自定义插件开发</h1><p><a name="6e3f99de"></a></p>
<h3 id="三种方式"><a href="#三种方式" class="headerlink" title="三种方式"></a>三种方式</h3><table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Build script</td>
<td>把插件写在 build.gradle 文件中，一般用于简单的逻辑，只在该 build.gradle 文件中可见</td>
</tr>
<tr>
<td>buildSrc 项目</td>
<td>将插件源代码放在 rootProjectDir/buildSrc/src/main/groovy 中，只对该项目中可见，适用于逻辑较为复杂</td>
</tr>
<tr>
<td><strong>独立项目</strong></td>
<td>一个独立的 Groovy 和 Java 项目，可以把这个项目打包成 Jar 文件包，一个 Jar 文件包还可以包含多个插件入口，将文件包发布到托管平台上，供其他人使用。本文将着重介绍此类。</td>
</tr>
</tbody>
</table>
<p>具体从插件开发可以参考</p>
<ul>
<li><a href="https://xsfelvis.github.io/2018/06/09/%E8%AF%91%E6%96%87_Writing%20Custom%20Plugins/">Writing Custom Plugins</a></li>
<li><a href="http://blog.bugtags.com/2016/03/28/embrace-android-studio-gradle-plugin/" target="_blank" rel="noopener">拥抱 Android Studio 之五：Gradle 插件开发</a></li>
<li><a href="http://lijiankun24.com/%E7%83%AD%E4%BF%AE%E5%A4%8D%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A1%86%E6%9E%B6%E9%9B%8F%E5%BD%A2%EF%BC%88%E4%B8%89%EF%BC%89/" target="_blank" rel="noopener">热修复之自定义热修复框架雏形（三）</a></li>
</ul>
<p>需要注意的是 在main目录下创建<br>1、resources/META-INF/gradle-plugins文件夹，<br>2、在<strong>gradle-plugins文件夹下创建一个xxx.properties文件</strong>，(<strong>com.learntransform.testtransform.properties</strong>)<br>注意：这个xxx就是在app下的build.gradle中引入时的名字，例如：<strong>apply plugin: ‘xxx’（</strong>apply plugin:’com.learntransform.testtransform’<strong>）</strong><br>3、在文件书写引用到插件 implementation-class=me.xsfdev.learntransform.Hotfix<br><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556806007519-8dca98a3-a43f-4ffa-b4ba-451bf4ce8f30.png#align=left&amp;display=inline&amp;height=275&amp;name=image.png&amp;originHeight=549&amp;originWidth=1000&amp;size=339915&amp;status=done&amp;width=500" alt="image.png"></p>
<p><a name="73a05e0f"></a></p>
<h3 id="插件的本地化"><a href="#插件的本地化" class="headerlink" title="插件的本地化"></a>插件的本地化</h3><ul>
<li>本地插件module</li>
<li><p><br></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">group = &apos;com.learntranform&apos;</span><br><span class="line">version = &apos;1.0.1&apos;</span><br><span class="line">uploadArchives &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        flatDir &#123;</span><br><span class="line">            name &quot;localRepository&quot;</span><br><span class="line">            dir &quot;../app/localRepository/libs&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>工程的gradle</p>
</li>
<li><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    ext.kotlin_version = <span class="string">'1.2.41'</span></span><br><span class="line">    repositories &#123;</span><br><span class="line">        flatDir &#123;</span><br><span class="line">            name <span class="string">'localRepository'</span></span><br><span class="line">            dir <span class="string">"app/localRepository/libs"</span></span><br><span class="line">        &#125;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        jcenter()</span><br><span class="line">        google()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath(group: <span class="string">'com.plugintest'</span>, name: <span class="string">'hellodsl'</span>, version: <span class="string">'1.0.0'</span>) &#123;</span><br><span class="line">            changing = <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        classpath(group: <span class="string">'com.learntransform'</span>, name: <span class="string">'learntransform'</span>, version: <span class="string">'1.0.1'</span>) &#123;</span><br><span class="line">            changing = <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        classpath <span class="string">'com.android.tools.build:gradle:3.1.2'</span></span><br><span class="line">        classpath <span class="string">"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"</span></span><br><span class="line">        classpath <span class="string">'com.novoda:bintray-release:0.8.0'</span> <span class="comment">//jcenter添加</span></span><br><span class="line">        classpath <span class="string">'com.xsfdev:complexcriptdsl:1.0.0'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>完整代码可以参考 <a href="https://github.com/xsfelvis/GradlePluginStudy/blob/master/learntransform/build.gradle" target="_blank" rel="noopener">LearnGradle</a></p>
<p><a name="4YWev"></a></p>
<h1 id="5、常用方法"><a href="#5、常用方法" class="headerlink" title="5、常用方法"></a>5、常用方法</h1><p><a name="android.applicationVariants"></a></p>
<h2 id="android-applicationVariants"><a href="#android-applicationVariants" class="headerlink" title="android.applicationVariants"></a>android.applicationVariants</h2><p>更多参考需要看源码</p>
<p>android.applicationVariants 返回的是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public DomainObjectSet&lt;ApplicationVariant&gt; getApplicationVariants() &#123;</span><br><span class="line">      return applicationVariantList;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>一层层追 相关的有<br><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556122864808-85593771-2038-40a0-a121-faca52cabe6b.png#align=left&amp;display=inline&amp;height=769&amp;name=image.png&amp;originHeight=1442&amp;originWidth=1398&amp;size=163578&amp;status=done&amp;width=746" alt="image.png"><br>在BaseVariant中<br><img src="https://cdn.nlark.com/yuque/0/2019/png/215777/1556123502143-259a6f70-5190-4072-9cd2-dc93476d3a29.png#align=left&amp;display=inline&amp;height=611&amp;name=image.png&amp;originHeight=611&amp;originWidth=439&amp;size=95538&amp;status=done&amp;width=439" alt="image.png"></p>
<p><a name="UWA8x"></a></p>
<h2 id="Task-upToDateWhen"><a href="#Task-upToDateWhen" class="headerlink" title="Task#upToDateWhen"></a>Task#upToDateWhen</h2><p>每次都会编译</p>
<p><code>outputs.upToDateWhen { true }</code> doesn’t mean “the task is up-to-date.” It just means that the outputs are up-to-date for that particular spec. Gradle will still do its own up-to-date checks.<br>The other thing that may be confusing is where the task’s actions are defined. If the actions are defined in the build script, the build script itself is an input to the task. So changes to the build script will make the task out-of-date.<br>So if I had a task like:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">task myTask &#123;</span><br><span class="line">    def outputFile = file(&quot;output.txt&quot;)</span><br><span class="line">    outputs.file outputFile</span><br><span class="line">    doLast &#123;</span><br><span class="line">        outputFile.text = &quot;Done&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    outputs.upToDateWhen &#123; false &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Whenever I run this, <code>myTask</code> is out-of-date. If I switch the false to true, the first time I run it, the task is out-of-date still (because the buildscript changed). When I run it again, it would be up-to-date (all inputs are the same). You’ll see this at <code>--info</code> level logging.</p>
<p><a name="0JsjK"></a></p>
<h1 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h1><p><a name="VXMJb"></a></p>
<h2 id="Failed-to-notify-project-evaluation-listener"><a href="#Failed-to-notify-project-evaluation-listener" class="headerlink" title="Failed to notify project evaluation listener"></a>Failed to notify project evaluation listener</h2><p>The versions of the Android Gradle plugin and Gradle are not compatible.</p>
<p><a name="nLY5q"></a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://juejin.im/post/5b000522f265da0b7f44d1c7" target="_blank" rel="noopener">作为Android开发你必须明白的Gradle基础</a></li>
<li><a href="https://www.ctolib.com/topics-123427.html" target="_blank" rel="noopener">使用</a><a href="https://www.ctolib.com/topics-123427.html" target="_blank" rel="noopener">IDEA</a><a href="https://www.ctolib.com/topics-123427.html" target="_blank" rel="noopener">开发</a><a href="https://www.ctolib.com/topics-123427.html" target="_blank" rel="noopener">Gradle</a><a href="https://www.ctolib.com/topics-123427.html" target="_blank" rel="noopener">插件</a><a href="https://www.ctolib.com/topics-123427.html" target="_blank" rel="noopener"> : </a><a href="https://www.ctolib.com/topics-123427.html" target="_blank" rel="noopener">获取</a><a href="https://www.ctolib.com/topics-123427.html" target="_blank" rel="noopener">Android</a><a href="https://www.ctolib.com/topics-123427.html" target="_blank" rel="noopener">工程信息</a></li>
<li><a href="https://www.jianshu.com/u/5ac1ca917290" target="_blank" rel="noopener">https://www.jianshu.com/u/5ac1ca917290</a></li>
<li><a href="https://www.jianshu.com/p/8e89a0b8acf8" target="_blank" rel="noopener">Android Gradle</a><a href="https://www.jianshu.com/p/8e89a0b8acf8" target="_blank" rel="noopener">学习(二)：如何创建</a><a href="https://www.jianshu.com/p/8e89a0b8acf8" target="_blank" rel="noopener">Task</a></li>
<li><a href="https://www.jianshu.com/p/c45861426eba" target="_blank" rel="noopener">Android Gradle</a><a href="https://www.jianshu.com/p/c45861426eba" target="_blank" rel="noopener">学习(三)：</a><a href="https://www.jianshu.com/p/c45861426eba" target="_blank" rel="noopener">Task</a><a href="https://www.jianshu.com/p/c45861426eba" target="_blank" rel="noopener">进阶学习</a></li>
<li><a href="https://www.jianshu.com/p/e5de9538effa" target="_blank" rel="noopener">Project详解(四)</a></li>
<li><a href="https://www.jianshu.com/p/167cd4b82653" target="_blank" rel="noopener">Android Gradle</a><a href="https://www.jianshu.com/p/167cd4b82653" target="_blank" rel="noopener">学习(六)：</a><a href="https://www.jianshu.com/p/167cd4b82653" target="_blank" rel="noopener">NamedDomainObjectContainer</a><a href="https://www.jianshu.com/p/167cd4b82653" target="_blank" rel="noopener">详解</a></li>
<li><a href="https://www.jianshu.com/p/2e19268bf387" target="_blank" rel="noopener">Android Gradle</a><a href="https://www.jianshu.com/p/2e19268bf387" target="_blank" rel="noopener">学习(七)：</a><a href="https://www.jianshu.com/p/2e19268bf387" target="_blank" rel="noopener">Gradle</a><a href="https://www.jianshu.com/p/2e19268bf387" target="_blank" rel="noopener">构建生命周期</a></li>
<li><a href="http://www.cnblogs.com/davenkin/p/gradle-learning-1.html" target="_blank" rel="noopener">Gradle</a><a href="http://www.cnblogs.com/davenkin/p/gradle-learning-1.html" target="_blank" rel="noopener">学习系列之一</a><a href="http://www.cnblogs.com/davenkin/p/gradle-learning-1.html" target="_blank" rel="noopener">——Gradle</a><a href="http://www.cnblogs.com/davenkin/p/gradle-learning-1.html" target="_blank" rel="noopener">快速入门</a></li>
<li><a href="https://blog.csdn.net/zhaoyanjun6/column/info/18954" target="_blank" rel="noopener">Gradle实战指南</a></li>
</ul>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    云来
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://xsfelvis.github.io/2019/05/02/Gradle插件从入门到进阶/" title="Gradle插件从入门到进阶">https://xsfelvis.github.io/2019/05/02/Gradle插件从入门到进阶/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Gradle插件/" rel="tag"># Gradle插件</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/19/EasyAdapter/" rel="next" title="EasyAdapter">
                <i class="fa fa-chevron-left"></i> EasyAdapter
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/02/gradle插件调试/" rel="prev" title="Gradle插件调试">
                Gradle插件调试 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNzA1My8xMzU4OQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="云来" />
            
              <p class="site-author-name" itemprop="name">云来</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

			<!--my custom code begin-->
			<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.5.0/velocity.min.js"></script>
			<script type="text/javascript">
			  $("#sidebar").hover(function(){
				$("#mydivshow").velocity('stop').velocity({opacity: 1});
			  },function(){
				$("#mydivshow").velocity('stop').velocity({opacity: 0});
			  });
			</script>
			<div id="mydivshow" class="mydivshow">
			<!--my custom code end-->
			
          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/xsfelvis" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://blog.csdn.net/XSF50717" target="_blank" title="CSDN">
                    
                      <i class="fa fa-fw fa-csdn"></i>CSDN</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://juejin.im/user/5643754060b27f7a018bd10d" target="_blank" title="掘金">
                    
                      <i class="fa fa-fw fa-juejin"></i>掘金</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:xsfelvis@gmail.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://juejin.im/timeline" title="稀土掘金" target="_blank">稀土掘金</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://gank.io/" title="干货集中营" target="_blank">干货集中营</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://wanandroid.com/tools" title="玩Android" target="_blank">玩Android</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://tech.meituan.com/" title="美团点评" target="_blank">美团点评</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.androidblog.cn/about/" title="酷站" target="_blank">酷站</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://pingguohe.net/" title="苹果核" target="_blank">苹果核</a>
                  </li>
                
              </ul>
            </div>
          

          <div id="player1" class="aplayer"></div>
<script src="/js/src/APlayer.min.js"></script>
<script type="text/javascript">
var ap = new APlayer({
    element: document.getElementById('player1'),                       // Optional, player element
    narrow: false,                                                     // Optional, narrow style
    autoplay: false,                                                    // Optional, autoplay song(s), not supported by mobile browsers
    showlrc: 0,                                                        // Optional, show lrc, can be 0, 1, 2, see: ###With lrc
    mutex: true,                                                       // Optional, pause other players when this player playing
    theme: '#e6d0b2',                                                  // Optional, theme color, default: #b7daff
    mode: 'random',                                                    // Optional, play mode, can be `random` `single` `circulation`(loop) `order`(no loop), default: `circulation`
    preload: 'metadata',                                               // Optional, the way to load music, can be 'none' 'metadata' 'auto', default: 'auto'
    listmaxheight: '513px',                                             // Optional, max height of play list
    music: {                                                           // Required, music info, see: ###With playlist
        title: 'Summertime Sadness',                                          // Required, music title
        author: 'cover',                          // Required, music author
        url: 'http://www.170mv.com/kw/other.web.rb01.sycdn.kuwo.cn/resource/n2/71/36/4211820203.mp3',  // Required, music url
        pic: '/images/music.jpg',  // Optional, music picture
    }
});
</script>
        </div>
		<!--my custom code begin-->
		</div>
		<!--my custom code end-->
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Gradle插件从入门到进阶"><span class="nav-number">1.</span> <span class="nav-text">Gradle插件从入门到进阶</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1、简介"><span class="nav-number">2.</span> <span class="nav-text">1、简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Groovy-基础"><span class="nav-number">2.1.</span> <span class="nav-text">Groovy 基础</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Android-DSL-基础"><span class="nav-number">2.2.</span> <span class="nav-text">Android DSL 基础</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2、核心概念"><span class="nav-number">3.</span> <span class="nav-text">2、核心概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Project对象"><span class="nav-number">3.1.</span> <span class="nav-text">Project对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#项目配置"><span class="nav-number">3.1.1.</span> <span class="nav-text">项目配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Task"><span class="nav-number">3.2.</span> <span class="nav-text">Task</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Task的Actions"><span class="nav-number">3.2.1.</span> <span class="nav-text">Task的Actions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Task的几种常见写法"><span class="nav-number">3.2.2.</span> <span class="nav-text">Task的几种常见写法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Task的依赖"><span class="nav-number">3.2.3.</span> <span class="nav-text">Task的依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Task的类型"><span class="nav-number">3.2.4.</span> <span class="nav-text">Task的类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义Task"><span class="nav-number">3.2.5.</span> <span class="nav-text">自定义Task</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Task的类图"><span class="nav-number">3.2.6.</span> <span class="nav-text">Task的类图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TaskContainer接口解析"><span class="nav-number">3.2.7.</span> <span class="nav-text">TaskContainer接口解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Task的增量构建"><span class="nav-number">3.2.8.</span> <span class="nav-text">Task的增量构建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TaskInputs、TaskOutputs介绍"><span class="nav-number">3.2.8.1.</span> <span class="nav-text">TaskInputs、TaskOutputs介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#taskInputs、taskOutputs注解"><span class="nav-number">3.2.8.2.</span> <span class="nav-text">taskInputs、taskOutputs注解</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Property"><span class="nav-number">3.3.</span> <span class="nav-text">Property</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ext命名空间"><span class="nav-number">3.3.1.</span> <span class="nav-text">ext命名空间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#属性文件"><span class="nav-number">3.3.2.</span> <span class="nav-text">属性文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ExtensionContainer"><span class="nav-number">3.4.</span> <span class="nav-text">ExtensionContainer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Extension简介"><span class="nav-number">3.4.1.</span> <span class="nav-text">Extension简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#简单的Extension"><span class="nav-number">3.4.2.</span> <span class="nav-text">简单的Extension</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ExtensionContainer主要api及用法"><span class="nav-number">3.4.3.</span> <span class="nav-text">ExtensionContainer主要api及用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#增加Extension"><span class="nav-number">3.4.4.</span> <span class="nav-text">增加Extension</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查找Extension"><span class="nav-number">3.4.5.</span> <span class="nav-text">查找Extension</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#嵌套Extension-方式一"><span class="nav-number">3.4.6.</span> <span class="nav-text">嵌套Extension 方式一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#嵌套Extension方式二-NamedDomainObjectContainer"><span class="nav-number">3.4.7.</span> <span class="nav-text">嵌套Extension方式二(NamedDomainObjectContainer)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用场景"><span class="nav-number">3.4.7.1.</span> <span class="nav-text">使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#什么是NamedDomainObjectContainer"><span class="nav-number">3.4.7.2.</span> <span class="nav-text">什么是NamedDomainObjectContainer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建NamedDomainObjectContainer"><span class="nav-number">3.4.7.3.</span> <span class="nav-text">创建NamedDomainObjectContainer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查找和遍历"><span class="nav-number">3.4.7.4.</span> <span class="nav-text">查找和遍历</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Android的Extension"><span class="nav-number">3.4.8.</span> <span class="nav-text">Android的Extension</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3、构建生命周期"><span class="nav-number">4.</span> <span class="nav-text">3、构建生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#三个阶段"><span class="nav-number">4.0.1.</span> <span class="nav-text">三个阶段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Android-三个文件重要的gradle"><span class="nav-number">4.0.2.</span> <span class="nav-text">Android 三个文件重要的gradle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常用gradle命令"><span class="nav-number">4.0.3.</span> <span class="nav-text">常用gradle命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#监听生命周期"><span class="nav-number">4.0.4.</span> <span class="nav-text">监听生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Project"><span class="nav-number">4.0.4.1.</span> <span class="nav-text">Project</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Gradle"><span class="nav-number">4.0.4.2.</span> <span class="nav-text">Gradle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TaskExecutionGraph-Task执行图"><span class="nav-number">4.0.4.3.</span> <span class="nav-text">TaskExecutionGraph(Task执行图)</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4、自定义插件开发"><span class="nav-number">5.</span> <span class="nav-text">4、自定义插件开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#三种方式"><span class="nav-number">5.0.1.</span> <span class="nav-text">三种方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#插件的本地化"><span class="nav-number">5.0.2.</span> <span class="nav-text">插件的本地化</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5、常用方法"><span class="nav-number">6.</span> <span class="nav-text">5、常用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#android-applicationVariants"><span class="nav-number">6.1.</span> <span class="nav-text">android.applicationVariants</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Task-upToDateWhen"><span class="nav-number">6.2.</span> <span class="nav-text">Task#upToDateWhen</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#坑"><span class="nav-number">7.</span> <span class="nav-text">坑</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Failed-to-notify-project-evaluation-listener"><span class="nav-number">7.1.</span> <span class="nav-text">Failed to notify project evaluation listener</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-number">8.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">云来</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">112.0k</span>
  
</div>






  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a></div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  


<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>




  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("QFKdnKcTHhFexYDWSA4tMBzH-gzGzoHsz", "wq2r6eiGoNMmUhgBsA7hAO9a");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  
  


  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.3"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.3"></script>


  
  <script type="text/javascript" src="/js/src/exturl.js?v=5.1.3"></script>


  <script src="/js/src/Aplayer-Controler.js"></script>
<div id="AP-controler"></div>
<script type="text/javascript">
var myapc=new APlayer_Controler({
		APC_dom:$('#AP-controler'),
		aplayer:ap, //此为绑定的aplayer对象
		attach_right:false,
		position:{top:'300px',bottom:''},
		fixed:true,
		btn_width:100,
		btn_height:120,
		img_src:['http://oty1v077k.bkt.clouddn.com/bukagirl.jpg',
				'http://oty1v077k.bkt.clouddn.com/jumpgirl.jpg',
				'http://oty1v077k.bkt.clouddn.com/pentigirl.jpg',
				'http://oty1v077k.bkt.clouddn.com/%E8%90%8C1.gif'],
		img_style:{repeat:'no-repeat',position:'center',size:'contain'},
		ctrls_color:'rgba(173,255,47,0.8)',
		ctrls_hover_color:'rgba(255,140,0,0.7)',
		tips_on:true,
		tips_width:140,
		tips_height:25,
		tips_color:'rgba(255,255,255,0.6)',
		tips_content:{},
		timeout:30
	});
</script>
  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>



</body>
</html>
